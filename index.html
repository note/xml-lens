<html><head><title>xml-lens</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="pl.msitko" /><meta name="description" content="XML Optics library for Scala" /><meta name="og:image" content="/xml-lens/img/poster.png" /><meta name="og:title" content="xml-lens" /><meta name="og:site_name" content="xml-lens" /><meta name="og:url" content="http://note.github.io/xml-lens" /><meta name="og:type" content="website" /><meta name="og:description" content="XML Optics library for Scala" /><link rel="icon" type="image/png" href="/xml-lens/img/favicon.png" /><meta name="twitter:title" content="xml-lens" /><meta name="twitter:image" content="http://note.github.io/xml-lensimg/poster.png" /><meta name="twitter:description" content="XML Optics library for Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/xml-lens/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/xml-lens/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/xml-lens/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/xml-lens/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/xml-lens/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/xml-lens/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/xml-lens/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/xml-lens/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/xml-lens/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/xml-lens/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/xml-lens/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/xml-lens/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/xml-lens/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/xml-lens/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/xml-lens/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/xml-lens/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/xml-lens/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/xml-lens/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/xml-lens/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/xml-lens/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/xml-lens/highlight/styles/default.css" /><link rel="stylesheet" href="/xml-lens/css/style.css" /><link rel="stylesheet" href="/xml-lens/css/palette.css" /><link rel="stylesheet" href="/xml-lens/css/codemirror.css" /></head><body><header id="site-header"><div class="navbar-wrapper"><div class="container"><div class="row"><div class="col-xs-6"><a href="/xml-lens/" class="brand"><div class="icon-wrapper"><span>xml-lens</span></div></a></div><div class="col-xs-6"><nav class="text-right"><ul class=""><li><a href="https://github.com/note/xml-lens"><i class="fa fa-github"></i><span class="hidden-xs">GitHub</span></a></li><li><a href="/xml-lens/api"><i class="fa fa-file-text"></i><span class="hidden-xs">Documentation</span></a></li></ul></nav></div></div></div></div><div class="jumbotron"><div class="container"><h1 class="text-center">XML Optics library for Scala</h1><h2></h2><p class="text-center"><a href="https://github.com/note/xml-lens" class="btn btn-outline-inverse">View on GitHub</a></p></div></div><div><ul class="horizontalNav">       <li><a class="" href="/xml-lens/docs/quickstart.html">Quickstart</a></li>  <li><a class="" href="/xml-lens/docs/modularity.html">Modularity</a></li>  <li><a class="" href="/xml-lens/docs/optics.html">Optics API</a></li>  <li><a class="" href="/xml-lens/docs/cookbook.html">Cookbook</a></li>  <li><a class="" href="/xml-lens/docs/parsing.html">Parsing</a></li>  <li><a class="" href="/xml-lens/docs/printing.html">Printing</a></li>  <li><a class="" href="/xml-lens/docs/namespaces.html">Namespaces</a></li> </ul></div></header><main id="site-main"><section class="use"><div class="container"><div id="content"><p><a href="https://travis-ci.org/note/xml-lens"><img src="https://api.travis-ci.org/note/xml-lens.svg" alt="Build Status" /></a>
<a href="https://coveralls.io/github/note/xml-lens?branch=master"><img src="https://coveralls.io/repos/github/note/xml-lens/badge.svg?branch=master" alt="Coverage Status" /></a></p>

<h2 id="about">About</h2>

<p>XML Scala libraries are kind of neglected. That stands in stark contrast to JSON for which Scala has dozens of projects.
Of course, JSON is much more popular while XML is regarded a legacy standard. Still, there are many situations in which 
you need to work with XML. <code class="highlighter-rouge">xml-optics</code> is an attempt to make this experience as painless as possible.</p>

<p>Main focus of <code class="highlighter-rouge">xml-optics</code> is traversing and transforming XML trees - something <code class="highlighter-rouge">scala-xml</code> is not 
really good at. To make those operations easy to express the concept of <code class="highlighter-rouge">Optics</code> has been used. 
<a href="http://julien-truffaut.github.io/Monocle/">Monocle</a> has been used as an implementation of <code class="highlighter-rouge">Optics</code>.</p>

<p><code class="highlighter-rouge">xml-lens</code> is available for both Scala 2.11 and 2.12. It’s cross published for both JVM and Scala.js.</p>

<h2 id="how-to-read-this-document">How to read this document</h2>

<p>If you’re interested what is xml-lens and when it may be useful to you go <a href="#goals-and-non-goals-of-the-project">ahead</a>
with reading current page.</p>

<p>If you’re already convinced that you want to use it start by reading <a href="docs/quickstart.html">quickstart</a>.</p>

<h2 id="goals-and-non-goals-of-the-project">Goals and non-goals of the project</h2>

<p>Goals of the project:</p>

<ul>
  <li>provide optics API for transforming XML. It should be stressed out here: while <code class="highlighter-rouge">scala-xml</code> provides
 API sufficient for many operations it’s designed mostly with <code class="highlighter-rouge">read-transform-write</code> scenario in mind.</li>
  <li>provide easy to use API built on top of optics API</li>
  <li>reasonable performance (should not be much slower than e.g. <code class="highlighter-rouge">scala-xml</code>)</li>
  <li>scala.js support (differences between platform should be limited as far as it is possible)</li>
  <li>good documentation</li>
  <li>serve as experimentation field of what can be achieved with optics in regards of XML transformations.
There is nothing fancy in current implementation but there are many interesting direction for future
development.</li>
</ul>

<p>Non-goals of the project:</p>

<ul>
  <li>provide state of the art performance</li>
  <li>be DTD-aware</li>
  <li>be XSD Schema-aware</li>
</ul>

<h3 id="motivational-example">Motivational example</h3>

<p>Let’s assume that you need to transform text node <code class="highlighter-rouge">a/interesting/special</code> in the following XML to be
formatted with upper case.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="n">motivationalExample</span> <span class="k">=</span>
      <span class="s">"""&lt;?xml version="1.0" encoding="UTF-8"?&gt;
        |&lt;a&gt;
        |  &lt;boring&gt;
        |    &lt;special&gt;text&lt;/special&gt;
        |  &lt;/boring&gt;
        |  &lt;interesting&gt;
        |    &lt;special&gt;text&lt;/special&gt;
        |    &lt;boring&gt;text&lt;/boring&gt;
        |  &lt;/interesting&gt;
        |  &lt;special&gt;text&lt;/special&gt;
        |&lt;/a&gt;"""</span><span class="o">.</span><span class="n">stripMargin</span>
</code></pre></div></div>

<p>Instead of presenting you reference implementation in <code class="highlighter-rouge">scala-xml</code> first, we will start by taking
a look at solution with <code class="highlighter-rouge">xml-lens</code>. Such order will make it easier to understand the problem.</p>

<p>It will be easier to start with solution to motivational problem written with <code class="highlighter-rouge">xml-lens</code>.</p>

<p>With <code class="highlighter-rouge">xml-lens</code> you can solve motivational problem with:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">pl.msitko.xml.parsing.XmlParser</span>
<span class="k">import</span> <span class="nn">pl.msitko.xml.printing.XmlPrinter</span>
<span class="k">import</span> <span class="nn">pl.msitko.xml.dsl._</span>

<span class="k">val</span> <span class="n">parsed</span> <span class="k">=</span> <span class="nc">XmlParser</span><span class="o">.</span><span class="n">parse</span><span class="o">(</span><span class="n">motivationalExample</span><span class="o">).</span><span class="n">right</span><span class="o">.</span><span class="n">get</span>

<span class="k">val</span> <span class="n">modify</span> <span class="k">=</span> <span class="o">(</span><span class="n">root</span> <span class="o">\</span> <span class="s">"interesting"</span> <span class="o">\</span> <span class="s">"special"</span><span class="o">).</span><span class="n">hasTextOnly</span><span class="o">.</span><span class="n">modify</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">toUpperCase</span><span class="o">)</span>
<span class="k">val</span> <span class="n">res</span> <span class="k">=</span> <span class="n">modify</span><span class="o">(</span><span class="n">parsed</span><span class="o">)</span>

<span class="nc">XmlPrinter</span><span class="o">.</span><span class="n">print</span><span class="o">(</span><span class="n">res</span><span class="o">)</span>
</code></pre></div></div>

<p>The code is straightforward and declarative.</p>

<p>Actually it’s quite difficult to write the same logic with <code class="highlighter-rouge">scala-xml</code>. There is <code class="highlighter-rouge">scala.xml.transform</code>
API but it focuses on global transformation and here we want to transform just specific <code class="highlighter-rouge">special</code> node.
You can access that specific node with <code class="highlighter-rouge">"interesting" \ "special"</code> syntax in <code class="highlighter-rouge">scala-xml</code> too but as soon
as you do that you “lost” the rest of the document - in our case we want to return the whole XML document
with remaining nodes untouched.</p>

<p>Therefore you end up manipulating AST directly which is very cumbersome and error-prone:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">java.io.StringWriter</span>
<span class="k">import</span> <span class="nn">scala.xml.</span><span class="o">{</span><span class="nc">Elem</span><span class="o">,</span> <span class="nc">Text</span><span class="o">,</span> <span class="nc">XML</span><span class="o">}</span>

<span class="k">def</span> <span class="n">transform</span><span class="o">(</span><span class="n">el</span><span class="k">:</span> <span class="kt">Elem</span><span class="o">)</span><span class="k">:</span> <span class="kt">Elem</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">el</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">replaceWith</span> <span class="k">=</span> <span class="n">el</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">head</span> <span class="k">match</span> <span class="o">{</span>
        <span class="k">case</span> <span class="n">t</span><span class="k">:</span> <span class="kt">Text</span> <span class="o">=&gt;</span>
          <span class="nc">Text</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">toUpperCase</span><span class="o">)</span>
        <span class="k">case</span> <span class="n">a</span> <span class="k">=&gt;</span> <span class="n">a</span>
      <span class="o">}</span>
      <span class="n">el</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">child</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="n">replaceWith</span><span class="o">))</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">el</span>
    <span class="o">}</span>
  <span class="o">}</span>

<span class="k">val</span> <span class="n">xml</span> <span class="k">=</span> <span class="nc">XML</span><span class="o">.</span><span class="n">loadString</span><span class="o">(</span><span class="n">motivationalExample</span><span class="o">)</span>

<span class="k">val</span> <span class="n">transformed</span> <span class="k">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span>
  <span class="k">case</span> <span class="n">el</span><span class="k">:</span> <span class="kt">Elem</span> <span class="kt">if</span> <span class="kt">el.label</span> <span class="o">=</span><span class="k">=</span> <span class="s">"a"</span> <span class="k">=&gt;</span>
    <span class="n">el</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">child</span> <span class="k">=</span> <span class="n">el</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">flatMap</span> <span class="o">{</span>
      <span class="k">case</span> <span class="n">el</span><span class="k">:</span> <span class="kt">Elem</span> <span class="kt">if</span> <span class="kt">el.label</span> <span class="o">=</span><span class="k">=</span> <span class="s">"interesting"</span> <span class="k">=&gt;</span>
        <span class="n">el</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">child</span> <span class="k">=</span> <span class="n">el</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">flatMap</span> <span class="o">{</span>
          <span class="k">case</span> <span class="n">el</span><span class="k">:</span> <span class="kt">Elem</span> <span class="kt">if</span> <span class="kt">el.label</span> <span class="o">=</span><span class="k">=</span> <span class="s">"special"</span> <span class="k">=&gt;</span>
            <span class="n">transform</span><span class="o">(</span><span class="n">el</span><span class="o">)</span>
          <span class="k">case</span> <span class="n">a</span> <span class="k">=&gt;</span> <span class="n">a</span>
        <span class="o">})</span>
      <span class="k">case</span> <span class="n">a</span> <span class="k">=&gt;</span> <span class="n">a</span>
    <span class="o">})</span>
  <span class="k">case</span> <span class="n">a</span> <span class="k">=&gt;</span> <span class="n">a</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">writer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">StringWriter</span>

<span class="nc">XML</span><span class="o">.</span><span class="n">write</span><span class="o">(</span><span class="n">writer</span><span class="o">,</span> <span class="n">transformed</span><span class="o">.</span><span class="n">head</span><span class="o">,</span> <span class="s">"UTF-8"</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">toString</span>
</code></pre></div></div>

<p>As you can see it is really convoluted way of transforming XML. Of course, that code has a lot of
repetition and can probably be written more concisely with additional custom abstractions but the
point here is that <code class="highlighter-rouge">scala-xml</code> does not provide anything outside of the box.</p>

<h2 id="peculiarities">Peculiarities</h2>

<h3 id="ignoring-comments-and-processing-instructions-following-root-element">Ignoring comments and processing instructions following root element</h3>

<p>According to <a href="https://www.w3.org/TR/xml/#sec-well-formed">specs</a> XML document is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>document  ::=  prolog element Misc*
</code></pre></div></div>

<p>But for sake of simplicity xml-lens defines it rather as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>document  ::=  prolog element
</code></pre></div></div>

<p>That means that comments and processing instructions that are placed after the root element cannot be
expressed using <code class="highlighter-rouge">xml-lens</code> AST. Mind that it does not apply to comments and processing instructions which
are placed outside of root element but before it. Those items can be expressed in terms of <code class="highlighter-rouge">xml-lens</code> AST
as part of <code class="highlighter-rouge">Prolog</code>.</p>

<h2 id="license">License</h2>

<p>All code is available to you under the MIT license, available <a href="https://github.com/note/xml-lens/blob/master/LICENSE">here</a>.</p>

<h2 id="acknowledgements">Acknowledgements</h2>

<p>Many thanks to <a href="https://scalac.io/">scalac</a> that funded early development of <code class="highlighter-rouge">xml-lens</code>.</p>
</div></div></section><section class="technologies"><div class="container"><div class="row"></div></div></section></main><footer id="site-footer"><div class="container"><div class="row"><div class="col-xs-6"><p>xml-lens is designed and developed by <a href="" target="_blank">pl.msitko</a></p></div><div class="col-xs-6"><p class="text-right"><a href="https://github.com/note/xml-lens"><span class="fa fa-github"></span>View on GitHub</a></p></div></div><div class="row"><div class="col-xs-6"><p>Website built with <a href="https://47deg.github.io/sbt-microsites/" target="_blank">Sbt-microsites</a> - © 2016 <a href="https://www.47deg.com/" target="_blank">47 Degrees</a></p></div></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/xml-lens/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script></body></html>
